<!DOCTYPE html>

<html>
<head>
<style>
*{padding: 0px; margin: 0px;}
#container{
width: 350px;
margin: 100px auto;
}
#sudoku{
width: 350px;
height: 350px;
}
#sudoku div{
width: 11%;
height: 11%;
display: inline-block;
outline: 1px black solid;
text-align: center;
}
#sudoku div input{
	width: 100%;
	height: 100%;
	border: 0px;
	font-size: 20px;
	text-align: center;
}
#sudoku div input:focus{
	background-color: #D6E1FF;
}
button{
	border: 1px black solid;
	background: #FFF;
	padding: 5px;
	cursor: pointer;
}
</style>
<script src="js/jquery.js"></script>

</head>
<body>
<div id="container">
	<div id="sudoku">
	</div>
	<button id="solve">Solve!</button><br/>
	<input type="checkbox" id="show"/><label for="show">Show how it's done (shows each step)</label>
	
</div>
<script>
$(document).ready(function(){
	var SUDOKU = (function(){
			var that = {};
			var curTextBox = null;//holds the current textbox the user is focused on, this is the DOM node, not the jQuery object
			var solveIncrementally = false;
			var checkbox, button;
			var boxStorage = new Array(81);/*array of boxes, defined as follows:
				{
					val: <number>
					box: <textbox>
				}
			*/
			function get(x,y){
				return boxStorage[y * 9 + x].val;
			}
			function set(x,y,val){
				boxStorage[y * 9 + x].val = val;
			}
			function textBoxFocus(e){
				var targ = $(e.target);
				if(isNaN(targ.val()) || targ.val() == "0"){
					targ.val("");//clear it
				}
				curTextBox = e.target;
			}
			function textBoxBlur(e){
				if(curTextBox == e.target){
					curTextBox = null;
				}
			}
			function showFeedback(type, msg){
				console.log(type, msg);
			}
			function navigateFocus(dir){
				//get the current x-y coordinates that the user is in
				var parent = $(curTextBox).parent();
				var curx = parent.attr("data-x"),
					cury = parent.attr("data-y");
				switch(dir){
					case 37:
						curx--;
					break;
					case 38:
						cury--;
					break;
					case 39:
						curx++;
					break;
					case 40:
						cury++;
					break;
					default:
						return;//nope
					break;
				}
				if(curx < 1 || curx > 9 || cury < 1 || cury > 9){
					return;//invalid
				}
				//otherwise focus on the new one
				$("div[data-x=" + curx + "][data-y=" + cury + "] input").focus();
			}
			function solve(){
				//recursively solve this
				
			}

			function isValid(){

			}

			function validate(){
				//go through each box, set up each box in the array, set the vals
				for(var i = 0; i < 81; i++){
					var val = boxStorage[i].box.val();
					if(isNaN(val) || val == "0"){
						console.log("Invalid");
						return false;
					}
				}
			}

			function buttonClicked(){
				$(button).hide();	
				if(validate()){
					solve();
				}
				$(button).show();
			}

			function initUI(c){
				var frag = document.createDocumentFragment();
				for(var i = 1; i <= 9; i++){
					for(var j = 1; j <= 9; j++){
						//create body in jquery
						var box = $("<div>").addClass("box").attr("data-x", j).attr("data-y", i)[0],
							text = $("<input>").attr("type", "text").attr("maxlength", "1").on("focus", textBoxFocus).on("blur", textBoxBlur)[0];
						boxStorage.push({box: box, val: 0});
						box.appendChild(text);
						frag.appendChild(box);
					}
				}
				c.appendChild(frag);
				$(c).on("click", function(e){
					var targ = $(e.target);
					if(targ.hasClass("box")){
						targ.find("input").focus();
					}
				}).on("keydown", function(e){
					console.log(e.which);
					if(curTextBox != null){
						//ok then user might be trying to input a number
						//check if key is legit
						var character = String.fromCharCode(e.which);
						if(isNaN(character) || character == "0"){
							e.preventDefault();
							e.stopPropagation();
							//check if arrow key
							if(e.which >= 37 || e.which <= 40){
								navigateFocus(e.which);
							}
							return false;
						}
						else{
							$(curTextBox).val(character);
						}
					}
				});
			}
			that.init = function(stg){
				if(stg.hasOwnProperty("container")){
					initUI(stg.container);
				}
				if(stg.hasOwnProperty("button")){
					$(stg.button).on("click", buttonClicked);
					button = stg.button;
				}
				if(stg.hasOwnProperty("checkbox")){
					checkbox = stg.checkbox;
				}
			}
			return that;
	}());
	SUDOKU.init(
		{
			container: document.getElementById("sudoku"),
			button: document.getElementById("solve"),
			checkbox: document.getElementById("show")
		}
	); 
});
</script>
</body>

</html>
